#!/bin/bash

cmd="$1"
shift

ANSIBLE_INVENTORY_FILE=${ANSIBLE_INVENTORY_FILE:-inventory}

# VÃ©rifier si le fichier d'inventaire existe
if [ ! -f "$ANSIBLE_INVENTORY_FILE" ]; then
    echo "âŒ Error: Inventory file '$ANSIBLE_INVENTORY_FILE' does not exist"
    echo "ðŸ’¡ Make sure you're in a directory containing an inventory file"
    echo "ðŸ’¡ Or specify the correct file with ANSIBLE_INVENTORY_FILE=your_file"
    exit 1
fi

SSHPASS_MOUNT=""
if command -v sshpass >/dev/null 2>&1; then
    SSHPASS_MOUNT="-v $(which sshpass):/usr/bin/sshpass"
fi

echo "ðŸ“‹ Using inventory file: $ANSIBLE_INVENTORY_FILE"

# ExÃ©cuter la commande Ansible correspondante dans Docker
docker run --rm \
    --network host \
    -e ANSIBLE_INVENTORY="/app/ansible_inventory" \
    -e ANSIBLE_HOST_KEY_CHECKING=False \
    -v ~/.ssh:/root/.ssh \
    -v $(pwd):/app \
    -v "$(pwd)/$ANSIBLE_INVENTORY_FILE:/app/ansible_inventory" \
    $SSHPASS_MOUNT \
    -w /app \
    ansible "$cmd" "$@"
